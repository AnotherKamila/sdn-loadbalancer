{"height": 21, "width": 80, "env": {"TERM": "xterm", "SHELL": "/bin/bash"}, "version": 2, "timestamp": 1545082175}
[0.031801, "o", "\u001b]0;vagrant@p4: /project/test/l4_loadbalancer-unversioned\u0007vagrant@p4:/project/test/l4_loadbalancer-unversioned$ "]
[0.559133, "o", "pipenv run pytest -k add_di\rip -s "]
[1.012412, "o", "\r\n"]
[1.305471, "o", "\u001b[39m\u001b[1mLoading .env environment variables...\u001b[39m\u001b[22m"]
[1.305545, "o", "\r\n"]
[2.030202, "o", "\u001b[1;43mWARNING\u001b[1;0m: No route found for IPv6 destination :: (no default route?)\r\n"]
[2.135622, "o", "\u001b[1m============================= test session starts ==============================\u001b[0m\r\n"]
[2.135875, "o", "platform linux2 -- Python 2.7.12, pytest-4.0.1, py-1.7.0, pluggy-0.8.0\r\n"]
[2.136523, "o", "rootdir: /project/test, inifile: pytest.ini\r\n"]
[2.136664, "o", "plugins: twisted-1.8, timeout-1.3.3"]
[2.136884, "o", "\r\n"]
[2.1378, "o", "\u001b[1mcollecting ... \u001b[0m"]
[2.317045, "o", "\u001b[1m\rcollected 10 items / 9 deselected                                              \u001b[0m\r\n"]
[2.319161, "o", "\r\n"]
[2.319224, "o", "twisted_loadbalancing_test.py "]
[2.563586, "o", "*** Removing excess controllers/ofprotocols/ofdatapaths/pings/noxes\r\nkillall controller ofprotocol ofdatapath ping nox_corelt-nox_core ovs-openflowd ovs-controllerovs-testcontroller udpbwtest mnexec ivs ryu-manager 2> /dev/null\r\n"]
[3.57313, "o", "killall -9 controller ofprotocol ofdatapath ping nox_corelt-nox_core ovs-openflowd ovs-controllerovs-testcontroller udpbwtest mnexec ivs ryu-manager 2> /dev/null\r\n"]
[3.600183, "o", "pkill -9 -f \"sudo mnexec\"\r\n"]
[3.616854, "o", "*** Removing junk from /tmp\r\n"]
[3.617239, "o", "rm -f /tmp/vconn* /tmp/vlogs* /tmp/*.out /tmp/*.log\r\n"]
[3.621586, "o", "*** Removing old X11 tunnels\r\n"]
[3.630752, "o", "*** Removing excess kernel datapaths\r\n"]
[3.630838, "o", "ps ax | egrep -o 'dp[0-9]+' | sed 's/dp/nl:/'\r\n"]
[3.643998, "o", "***  Removing OVS datapaths\r\n"]
[3.644489, "o", "ovs-vsctl --timeout=1 list-br\r\n"]
[3.650668, "o", "ovs-vsctl --timeout=1 list-br\r\n"]
[3.656288, "o", "*** Removing all links of the pattern foo-ethX\r\n"]
[3.656402, "o", "ip link show | egrep -o '([-_.[:alnum:]]+-eth[[:digit:]]+)'\r\n"]
[3.661573, "o", "ip link show\r\n"]
[3.665571, "o", "*** Killing stale mininet node processes\r\npkill -9 -f mininet:\r\n"]
[3.682724, "o", "*** Shutting down stale tunnels\r\npkill -9 -f Tunnel=Ethernet\r\n"]
[3.699107, "o", "pkill -9 -f .ssh/mn\r\n"]
[3.716737, "o", "rm -f ~/.ssh/mn/*\r\n"]
[3.719863, "o", "*** Cleanup complete.\r\n"]
[3.720107, "o", "brctl show | awk 'FNR > 1 {print $1}'\r\n"]
[3.724279, "o", "find -type f -regex \".*cli_output.*\" | xargs rm\r\n"]
[3.731757, "o", "rm: missing operand\r\nTry 'rm --help' for more information.\r\n"]
[3.734598, "o", "killall simple_switch\r\n"]
[3.739695, "o", "simple_switch: no process found\r\n"]
[3.7415, "o", "p4c --target bmv2 --arch v1model --std p4-16 \"../../p4src/main-unversioned.p4\" -o \"/project/p4src\"\r\n"]
[5.367918, "o", "Switch port mapping:\r\ns1:  1:h1\t2:h2\t3:h3\t4:h4\t\r\n"]
[5.371112, "o", "*** Creating network\r\n*** Adding hosts:\r\n"]
[5.387714, "o", "h1 "]
[5.39976, "o", "h2 "]
[5.410763, "o", "h3 "]
[5.422169, "o", "h4 "]
[5.422387, "o", "\r\n*** Adding switches:\r\n"]
[5.446698, "o", "s1 "]
[5.447271, "o", "\r\n*** Adding links:\r\n"]
[5.481953, "o", "(h1, s1) "]
[5.505356, "o", "(h2, s1) "]
[5.542333, "o", "(h3, s1) "]
[5.571921, "o", "(h4, s1) "]
[5.572754, "o", "\r\n"]
[5.573455, "o", "*** Configuring hosts"]
[5.57358, "o", "\r\n"]
[5.573928, "o", "h1 "]
[5.60839, "o", "h2 "]
[5.623124, "o", "h3 "]
[5.637702, "o", "h4 "]
[5.65315, "o", "\r\n"]
[5.653368, "o", "*** Starting controller\r\n\r\n*** Starting 1 switches\r\n"]
[5.653439, "o", "s1 Starting P4 switch s1.\r\n"]
[5.653553, "o", "simple_switch -i 1@s1-eth1 -i 2@s1-eth2 -i 3@s1-eth3 -i 4@s1-eth4 --pcap=/project/test/l4_loadbalancer-unversioned/pcap --thrift-port 9090 --nanolog ipc:///tmp/bm-1-log.ipc --device-id 1 ../../p4src/main-unversioned.json --log-console >/project/test/l4_loadbalancer-unversioned/log/s1.log\r\n"]
[6.657904, "o", "P4 switch s1 has been started.\r\n"]
[6.65807, "o", "\r\n"]
[8.719039, "o", "s1 -> Thrift port: 9090\r\n**********\r\nNetwork configuration for: h1\r\n"]
[8.72006, "o", "Default interface: h1-eth0\t10.1.1.2\t00:00:0a:01:01:02\r\n**********\r\n**********\r\nNetwork configuration for: h2\r\nDefault interface: h2-eth0\t10.1.2.2\t00:00:0a:01:02:02\r\n**********\r\n**********\r\nNetwork configuration for: h3\r\nDefault interface: h3-eth0\t10.1.3.2\t00:00:0a:01:03:02\r\n**********\r\n**********\r\nNetwork configuration for: h4\r\nDefault interface: h4-eth0\t10.1.4.2\t00:00:0a:01:04:02\r\n**********\r\n\r\n======================================================================\r\nWelcome to the P4 Utils Mininet CLI!\r\n======================================================================\r\nYour P4 program is installed into the BMV2 software switch\r\nand your initial configuration is loaded. You can interact\r\nwith the network using the mininet CLI below.\r\n\r\nTo inspect or change the switch configuration, connect to\r\nits CLI from your host operating system using this command:\r\n  simple_switch_CLI --thrift-port <switch thrift port>\r\n\r\nTo view a switch log, run this command from your host OS:\r\n  tail -f /project/test/l4_loadbalanc"]
[8.720921, "o", "er-unversioned/log/<switchname>.log\r\n\r\nTo view the switch output pcap, check the pcap files in \r\n /project/test/l4_loadbalancer-unversioned/pcap:\r\n for example run:  sudo tcpdump -xxx -r s1-eth1.pcap\r\n\r\n"]
[8.727889, "o", "*** Starting CLI:\r\n"]
[9.388112, "o", " --------- prepare server, client, and loadbalancer ---------\r\n"]
[9.520499, "o", " ******  mx h1 pipenv run python -m myutils.client /tmp/p4crap-myutils.client-1.socket  ****** \r\n"]
[9.649415, "o", " ******  mx h2 pipenv run python -m myutils.server /tmp/p4crap-myutils.server-2.socket 8001  ****** \r\n"]
[9.661186, "o", "Switch s1 has no cpu port\r\n"]
[9.689511, "o", "Adding entry to exact match table mac\r\n"]
[9.690079, "o", "match key:           EXACT-00:00:0a:01:04:02\r\naction:              forward\r\nruntime data:        00:04\r\n"]
[9.690397, "o", "Entry has been added with handle 0\r\n\r\n"]
[9.691595, "o", "Adding entry to exact match table mac\r\n"]
[9.692102, "o", "match key:           EXACT-00:00:0a:01:01:02\r\naction:              forward\r\nruntime data:        00:01\r\n"]
[9.692378, "o", "Entry has been added with handle 1\r\n\r\n"]
[9.694761, "o", "Adding entry to exact match table mac\r\n"]
[9.69538, "o", "match key:           EXACT-00:00:0a:01:03:02\r\naction:              forward\r\nruntime data:        00:03\r\nEntry has been added with handle 2"]
[9.695668, "o", "\r\n\r\n"]
[9.701083, "o", "Adding entry to exact match table mac\r\nmatch key:           EXACT-00:00:0a:01:02:02\r\naction:              forward\r\nruntime data:        00:02\r\n"]
[9.701705, "o", "Entry has been added with handle 3\r\n\r\n"]
[9.757384, "o", "Adding entry to exact match table ipv4_arp\r\nmatch key:           EXACT-0a:01:04:02\r\naction:              set_dst_mac\r\n"]
[9.75789, "o", "runtime data:        00:00:0a:01:04:02\r\n"]
[9.758266, "o", "Entry has been added with handle 0\r\n\r\n"]
[9.762112, "o", "Adding entry to exact match table ipv4_arp\r\n"]
[9.762603, "o", "match key:           EXACT-0a:01:01:02\r\naction:              set_dst_mac\r\nruntime data:        00:00:0a:01:01:02\r\n"]
[9.764763, "o", "Entry has been added with handle 1\r\n\r\n"]
[9.773561, "o", "Adding entry to exact match table ipv4_arp\r\nmatch key:           EXACT-0a:01:03:02\r\n"]
[9.774088, "o", "action:              set_dst_mac\r\nruntime data:        00:00:0a:01:03:02\r\n"]
[9.775789, "o", "Entry has been added with handle 2\r\n\r\n"]
[9.781674, "o", "Adding entry to exact match table ipv4_arp\r\nmatch key:           EXACT-0a:01:02:02\r\naction:              set_dst_mac\r\n"]
[9.782258, "o", "runtime data:        00:00:0a:01:02:02\r\n"]
[9.788159, "o", "Entry has been added with handle 3\r\n\r\n"]
[9.816544, "o", "Adding entry to lpm match table ipv4_routing\r\nmatch key:           LPM-0a:01:02:00/24\r\naction:              ipv4_direct\r\nruntime data:        00\r\n"]
[9.81733, "o", "Entry has been added with handle 0\r\n\r\n"]
[9.825284, "o", "Adding entry to lpm match table ipv4_routing\r\nmatch key:           LPM-0a:01:04:00/24\r\naction:              ipv4_direct\r\nruntime data:        01\r\n"]
[9.825871, "o", "Entry has been added with handle 1\r\n\r\n"]
[9.838359, "o", "Adding entry to lpm match table ipv4_routing\r\nmatch key:           LPM-0a:01:01:00/24\r\naction:              ipv4_direct\r\nruntime data:        02\r\n"]
[9.83906, "o", "Entry has been added with handle 2\r\n\r\n"]
[9.849128, "o", "Adding entry to lpm match table ipv4_routing\r\nmatch key:           LPM-0a:01:03:00/24\r\naction:              ipv4_direct\r\nruntime data:        03\r\n"]
[9.85007, "o", "Entry has been added with handle 3\r\n\r\n"]
[9.939595, "o", "Loading .env environment variables...\r\n"]
[10.089114, "o", "Loading .env environment variables..."]
[10.089622, "o", "\r\n"]
[11.668972, "o", " --------- set up the pool ---------\r\n"]
[11.6743, "o", "LoadBalancerUnversioned: add_pool(10.0.0.1, 8000)\r\n"]
[11.686886, "o", "P4Table<ipv4_vips>: add([u'10.0.0.1', 8000], set_dip_pool, [0, 0])\r\n"]
[11.694653, "o", "Adding entry to exact match table ipv4_vips\r\nmatch key:           EXACT-0a:00:00:01\tEXACT-1f:40\r\naction:              set_dip_pool\r\nruntime data:        00\t00\r\n"]
[11.696318, "o", "Entry has been added with handle 0\r\n\r\n"]
[11.697331, "o", "P4Table<ipv4_vips>: add([u'10.0.0.1', 8000], set_dip_pool, [0, 0]) -> None"]
[11.697942, "o", "\r\n"]
[11.69928, "o", "P4Table<ipv4_vips_inverse>: add([0], ipv4_tcp_rewrite_src, [u'10.0.0.1', 8000])"]
[11.699788, "o", "\r\n"]
[11.702377, "o", "Adding entry to exact match table ipv4_vips_inverse\r\nmatch key:           EXACT-00\r\naction:              ipv4_tcp_rewrite_src\r\nruntime data:        0a:00:00:01\t1f:40\r\n"]
[11.703007, "o", "Entry has been added with handle 0\r\n\r\n"]
[11.703696, "o", "P4Table<ipv4_vips_inverse>: add([0], ipv4_tcp_rewrite_src, [u'10.0.0.1', 8000]) -> None"]
[11.704203, "o", "\r\n"]
[11.705145, "o", "LoadBalancerUnversioned: add_pool(10.0.0.1, 8000) -> 0"]
[11.705776, "o", "\r\n"]
[11.70768, "o", "LoadBalancerUnversioned: add_dip(0, 10.1.2.2, 8001)"]
[11.708126, "o", "\r\n"]
[11.710224, "o", "P4Table<ipv4_dips>: add([0, 0], ipv4_tcp_rewrite_dst, [u'10.1.2.2', 8001])"]
[11.710701, "o", "\r\n"]
[11.713583, "o", "Adding entry to exact match table ipv4_dips\r\nmatch key:           EXACT-00\tEXACT-00\r\naction:              ipv4_tcp_rewrite_dst\r\nruntime data:        0a:01:02:02\t1f:41\r\n"]
[11.714276, "o", "Entry has been added with handle 0\r\n\r\n"]
[11.714726, "o", "P4Table<ipv4_dips>: add([0, 0], ipv4_tcp_rewrite_dst, [u'10.1.2.2', 8001]) -> None\r\n"]
[11.71535, "o", "P4Table<ipv4_dips_inverse>: add([u'10.1.2.2', 8001], set_dip_pool_idonly, [0])\r\n"]
[11.717223, "o", "Adding entry to exact match table ipv4_dips_inverse\r\nmatch key:           EXACT-0a:01:02:02\tEXACT-1f:41\r\naction:              set_dip_pool_idonly\r\n"]
[11.717275, "o", "runtime data:        00\r\n"]
[11.718003, "o", "Entry has been added with handle 0\r\n\r\n"]
[11.718451, "o", "P4Table<ipv4_dips_inverse>: add([u'10.1.2.2', 8001], set_dip_pool_idonly, [0]) -> None\r\n"]
[11.719125, "o", "LoadBalancerUnversioned: _set_pool_size(0)\r\n"]
[11.719931, "o", "modifying size for pool (u'10.0.0.1', 8000) (0) => 1\r\n"]
[11.721108, "o", "P4Table<ipv4_vips>: modify((u'10.0.0.1', 8000), set_dip_pool, [0, 1])\r\n"]
[11.722455, "o", "Modifying entry 0 for exact match table ipv4_vips\r\n"]
[11.724208, "o", "P4Table<ipv4_vips>: modify((u'10.0.0.1', 8000), set_dip_pool, [0, 1]) -> None\r\n"]
[11.726022, "o", "LoadBalancerUnversioned: _set_pool_size(0) -> None\r\n"]
[11.726737, "o", "LoadBalancerUnversioned: add_dip(0, 10.1.2.2, 8001) -> None\r\n"]
[11.727032, "o", " --------- check that it worked ---------\r\n"]
[16.165285, "o", "47/47 connections successful\r\n"]
[16.167655, "o", "\u001b[32m.\u001b[0m"]
[16.169985, "o", " ******  sudo kill -SIGTERM -- -20458  ****** \r\n"]
[16.182384, "o", " ******  sudo kill -SIGTERM -- -20473  ****** \r\n"]
[16.195659, "o", "\r\n"]
[16.196223, "o", "*** Stopping 0 controllers\r\n\r\n*** Stopping 4 links\r\n."]
[16.229961, "o", "."]
[16.249743, "o", "."]
[16.292179, "o", "."]
[16.316127, "o", "\r\n"]
[16.316689, "o", "*** Stopping 1 switches\r\ns1 "]
[16.445884, "o", "\r\n"]
[16.447258, "o", "*** Stopping 4 hosts"]
[16.447735, "o", "\r\nh1 "]
[16.44947, "o", "h2 "]
[16.450978, "o", "h3 "]
[16.452075, "o", "h4 "]
[16.453369, "o", "\r\n"]
[16.453918, "o", "*** Done\r\nmininet> "]
[16.52388, "o", "\r\n"]
[16.524525, "o", "\r\n"]
[16.52513, "o", "\u001b[32m\u001b[1m=================== 1 passed, 9 deselected in 14.39 seconds ====================\u001b[0m\r\n"]
[16.586982, "o", "\u001b]0;vagrant@p4: /project/test/l4_loadbalancer-unversioned\u0007vagrant@p4:/project/test/l4_loadbalancer-unversioned$ "]
[19.794209, "o", "exit\r\n"]
